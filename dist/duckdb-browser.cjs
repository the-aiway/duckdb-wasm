"use strict";var Xr=Object.create;var se=Object.defineProperty;var Zr=Object.getOwnPropertyDescriptor;var en=Object.getOwnPropertyNames;var tn=Object.getPrototypeOf,rn=Object.prototype.hasOwnProperty;var nn=(r,e,t)=>e in r?se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var sn=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),on=(r,e)=>{for(var t in e)se(r,t,{get:e[t],enumerable:!0})},sr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of en(e))!rn.call(r,s)&&s!==t&&se(r,s,{get:()=>e[s],enumerable:!(n=Zr(e,s))||n.enumerable});return r};var an=(r,e,t)=>(t=r!=null?Xr(tn(r)):{},sr(e||!r||!r.__esModule?se(t,"default",{value:r,enumerable:!0}):t,r)),cn=r=>sr(se({},"__esModule",{value:!0}),r);var $=(r,e,t)=>(nn(r,typeof e!="symbol"?e+"":e,t),t);var zr=sn((yu,qr)=>{qr.exports=Worker});var Rs={};on(Rs,{AsyncDuckDB:()=>jt,AsyncDuckDBConnection:()=>Ie,AsyncDuckDBDispatcher:()=>Yt,AsyncPreparedStatement:()=>Et,AsyncResultStreamIterator:()=>_e,ConsoleLogger:()=>_t,DuckDBAccessMode:()=>or,DuckDBDataProtocol:()=>Ht,IsArrowBuffer:()=>fn,IsDuckDBWasmRetry:()=>mn,LogEvent:()=>dr,LogLevel:()=>ar,LogOrigin:()=>ur,LogTopic:()=>cr,PACKAGE_NAME:()=>Qt,PACKAGE_VERSION:()=>Kt,PACKAGE_VERSION_MAJOR:()=>fs,PACKAGE_VERSION_MINOR:()=>ms,PACKAGE_VERSION_PATCH:()=>hs,StatusCode:()=>lr,TokenType:()=>ir,VoidLogger:()=>It,WorkerRequestType:()=>Gt,WorkerResponseType:()=>Vt,WorkerTask:()=>u,createWorker:()=>gs,getJsDelivrBundles:()=>Is,getLogEventLabel:()=>un,getLogLevelLabel:()=>dn,getLogOriginLabel:()=>pn,getLogTopicLabel:()=>ln,getPlatformFeatures:()=>Kr,isFirefox:()=>Es,isNode:()=>er,isSafari:()=>ys,selectBundle:()=>_s});module.exports=cn(Rs);var or=(s=>(s[s.UNDEFINED=0]="UNDEFINED",s[s.AUTOMATIC=1]="AUTOMATIC",s[s.READ_ONLY=2]="READ_ONLY",s[s.READ_WRITE=3]="READ_WRITE",s))(or||{});var ir=(i=>(i[i.IDENTIFIER=0]="IDENTIFIER",i[i.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",i[i.STRING_CONSTANT=2]="STRING_CONSTANT",i[i.OPERATOR=3]="OPERATOR",i[i.KEYWORD=4]="KEYWORD",i[i.COMMENT=5]="COMMENT",i))(ir||{});var ar=(o=>(o[o.NONE=0]="NONE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARNING=3]="WARNING",o[o.ERROR=4]="ERROR",o))(ar||{}),cr=(i=>(i[i.NONE=0]="NONE",i[i.CONNECT=1]="CONNECT",i[i.DISCONNECT=2]="DISCONNECT",i[i.OPEN=3]="OPEN",i[i.QUERY=4]="QUERY",i[i.INSTANTIATE=5]="INSTANTIATE",i))(cr||{}),dr=(i=>(i[i.NONE=0]="NONE",i[i.OK=1]="OK",i[i.ERROR=2]="ERROR",i[i.START=3]="START",i[i.RUN=4]="RUN",i[i.CAPTURE=5]="CAPTURE",i))(dr||{}),ur=(o=>(o[o.NONE=0]="NONE",o[o.WEB_WORKER=1]="WEB_WORKER",o[o.NODE_WORKER=2]="NODE_WORKER",o[o.BINDINGS=3]="BINDINGS",o[o.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",o))(ur||{}),It=class{log(e){}},_t=class{constructor(e=2){this.level=e}log(e){e.level>=this.level&&console.log(e)}};function dn(r){switch(r){case 0:return"NONE";case 1:return"DEBUG";case 2:return"INFO";case 3:return"WARNING";case 4:return"ERROR";default:return"?"}}function un(r){switch(r){case 0:return"NONE";case 1:return"OK";case 2:return"ERROR";case 3:return"START";case 4:return"RUN";case 5:return"CAPTURE";default:return"?"}}function ln(r){switch(r){case 1:return"CONNECT";case 2:return"DISCONNECT";case 5:return"INSTANTIATE";case 3:return"OPEN";case 4:return"QUERY";default:return"?"}}function pn(r){switch(r){case 0:return"NONE";case 1:return"WEB WORKER";case 2:return"NODE WORKER";case 3:return"DUCKDB BINDINGS";case 4:return"DUCKDB";default:return"?"}}var lr=(n=>(n[n.SUCCESS=0]="SUCCESS",n[n.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",n[n.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",n))(lr||{});function fn(r){return r<=255}function mn(r){return r===256}var oe=Uint8Array.of(65,82,82,79,87,49),hn=Uint8Array.of(255,255,255,255,0,0,0,0),N={V1:0,V2:1,V3:2,V4:3,V5:4};var k={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},a={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},J={HALF:0,SINGLE:1,DOUBLE:2},x={DAY:0,MILLISECOND:1},E={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},L={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},C={Sparse:0,Dense:1};var X=Uint8Array,ge=Uint16Array,Re=Uint32Array,Te=BigUint64Array,ie=Int8Array,pr=Int16Array,b=Int32Array,O=BigInt64Array,gt=Float32Array,G=Float64Array;function fr(r){return r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer}function mr(r,e){let t=Math.log2(r)-3;return(e?[ie,pr,b,O]:[X,ge,Re,Te])[t]}var Ds=Object.getPrototypeOf(Int8Array);function Z(r,e){let t=0,n=r.length;if(n<=2147483648)do{let s=t+n>>>1;r[s]<=e?t=s+1:n=s}while(t<n);else do{let s=Math.trunc((t+n)/2);r[s]<=e?t=s+1:n=s}while(t<n);return t}function be(r,e,t){if(e(r))return r;throw new Error(t(r))}function A(r,e,t){return e=Array.isArray(e)?e:Object.values(e),be(r,n=>e.includes(n),t!=null?t:()=>`${r} must be one of ${e}`)}function Se(r,e){for(let[t,n]of Object.entries(r))if(n===e)return t;return"<Unknown>"}var U=r=>`Unsupported data type: "${Se(a,r)}" (id ${r})`,ae=(r,e,t=!0,n=null)=>({name:r,type:e,nullable:t,metadata:n});function hr(r){return Object.hasOwn(r,"name")&&Er(r.type)}function Er(r){return typeof(r==null?void 0:r.typeId)=="number"}function V(r,e="",t=!0){return hr(r)?r:ae(e,be(r,Er,()=>"Data type expected."),t)}var ke=(r,e,t=!1,n=-1)=>({typeId:a.Dictionary,id:n,dictionary:r,indices:e||ee(),ordered:t});var Oe=(r=32,e=!0)=>({typeId:a.Int,bitWidth:A(r,[8,16,32,64]),signed:e,values:mr(r,e)});var ee=()=>Oe(32);var Rt=(r=2)=>({typeId:a.Float,precision:A(r,J),values:[ge,gt,G][r]});var Tt=()=>({typeId:a.Binary,offsets:b}),Ae=()=>({typeId:a.Utf8,offsets:b});var bt=(r,e,t=128)=>({typeId:a.Decimal,precision:r,scale:e,bitWidth:A(t,[32,64,128,256]),values:t===32?b:Te});var St=r=>({typeId:a.Date,unit:A(r,x),values:r===x.DAY?b:O});var kt=(r=E.MILLISECOND)=>{r=A(r,E);let e=r===E.SECOND||r===E.MILLISECOND?32:64;return{typeId:a.Time,unit:r,bitWidth:e,values:e===32?b:O}};var De=(r=E.MILLISECOND,e=null)=>({typeId:a.Timestamp,unit:A(r,E),timezone:e,values:O}),Ot=(r=L.MONTH_DAY_NANO)=>({typeId:a.Interval,unit:A(r,L),values:r===L.MONTH_DAY_NANO?void 0:b}),Ne=r=>({typeId:a.List,children:[V(r)],offsets:b}),Le=r=>({typeId:a.Struct,children:Array.isArray(r)&&hr(r[0])?r:Object.entries(r).map(([e,t])=>ae(e,t))}),At=(r,e,t,n)=>(t!=null||(t=e.map((s,o)=>o)),{typeId:a.Union,mode:A(r,C),typeIds:t,typeMap:t.reduce((s,o,i)=>(s[o]=i,s),{}),children:e.map((s,o)=>V(s,`_${o}`)),typeIdForValue:n,offsets:b}),Dt=r=>({typeId:a.FixedSizeBinary,stride:r}),we=(r,e)=>({typeId:a.FixedSizeList,stride:e,children:[V(r)]}),yr=(r,e)=>({typeId:a.Map,keysSorted:r,children:[e],offsets:b});var Nt=(r=E.MILLISECOND)=>({typeId:a.Duration,unit:A(r,E),values:O}),Lt=()=>({typeId:a.LargeBinary,offsets:O}),wt=()=>({typeId:a.LargeUtf8,offsets:O}),Ft=r=>({typeId:a.LargeList,children:[V(r)],offsets:O}),Pt=(r,e)=>({typeId:a.RunEndEncoded,children:[be(V(r,"run_ends"),t=>t.type.typeId===a.Int,()=>"Run-ends must have an integer type."),V(e,"values")]});var xt=r=>({typeId:a.ListView,children:[V(r,"value")],offsets:b}),Ct=r=>({typeId:a.LargeListView,children:[V(r,"value")],offsets:O});var En=new G(2),Fe=En.buffer,vs=new O(Fe),Bs=new Re(Fe),Ms=new b(Fe),Ws=new X(Fe);function F(r){if(r>Number.MAX_SAFE_INTEGER||r<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${r}`);return Number(r)}function Pe(r,e){return Number(r/e)+Number(r%e)/Number(e)}var te=r=>BigInt.asUintN(64,r);function _r(r,e){return BigInt.asIntN(64,r[e])}function gr(r,e){let t=e<<1,n;return BigInt.asIntN(64,r[t+1])<0?(n=te(~r[t])|te(~r[t+1])<<64n,n=-(n+1n)):n=r[t]|r[t+1]<<64n,n}function Rr(r,e){let t=e<<2,n;return BigInt.asIntN(64,r[t+3])<0?(n=te(~r[t])|te(~r[t+1])<<64n|te(~r[t+2])<<128n|te(~r[t+3])<<192n,n=-(n+1n)):n=r[t]|r[t+1]<<64n|r[t+2]<<128n|r[t+3]<<192n,n}var In=new TextDecoder("utf-8"),Ys=new TextEncoder;function re(r){return In.decode(r)}var Y=4;function Ut(r,e){return(r[e>>3]&1<<e%8)!==0}function R(r,e){let t=e+f(r,e),n=t-f(r,t),s=_(r,n);return(o,i,c=null)=>{if(o<s){let d=_(r,n+o);if(d)return i(r,t+d)}return c}}function w(r,e){return e}function j(r,e){return!!_n(r,e)}function _n(r,e){return ce(r,e)<<24>>24}function ce(r,e){return r[e]}function _(r,e){return gn(r,e)<<16>>16}function gn(r,e){return r[e]|r[e+1]<<8}function f(r,e){return r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24}function Tr(r,e){return f(r,e)>>>0}function I(r,e){return F(BigInt.asIntN(64,BigInt(Tr(r,e))+(BigInt(Tr(r,e+Y))<<32n)))}function Q(r,e){let t=e+f(r,e),n=f(r,t);return t+=Y,re(r.subarray(t,t+n))}function D(r,e,t,n){if(!e)return[];let s=e+f(r,e);return Array.from({length:f(r,s)},(o,i)=>n(r,s+Y+i*t))}var xe=Symbol("rowIndex");function de(r,e){class t{constructor(o){this[xe]=o}toJSON(){return br(r,e,this[xe])}}let n=t.prototype;for(let s=0;s<r.length;++s){if(Object.hasOwn(n,r[s]))continue;let o=e[s];Object.defineProperty(n,r[s],{get(){return o.at(this[xe])},enumerable:!0})}return s=>new t(s)}function Ce(r,e){return t=>br(r,e,t)}function br(r,e,t){let n={};for(let s=0;s<r.length;++s)n[r[s]]=e[s].at(t);return n}function Sr(r){return r instanceof v}var H=class{constructor({length:e,nullCount:t,type:n,validity:s,values:o,offsets:i,sizes:c,children:d}){this.length=e,this.nullCount=t,this.type=n,this.validity=s,this.values=o,this.offsets=i,this.sizes=c,this.children=d,(!t||!this.validity)&&(this.at=p=>this.value(p))}get[Symbol.toStringTag](){return"Batch"}at(e){return this.isValid(e)?this.value(e):null}isValid(e){return Ut(this.validity,e)}value(e){return this.values[e]}slice(e,t){let n=t-e,s=Array(n);for(let o=0;o<n;++o)s[o]=this.at(e+o);return s}*[Symbol.iterator](){for(let e=0;e<this.length;++e)yield this.at(e)}};$(H,"ArrayType",null);var v=class extends H{constructor(e){super(e);let{length:t,values:n}=this;this.values=n.subarray(0,t)}slice(e,t){return this.nullCount?super.slice(e,t):this.values.subarray(e,t)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}},K=class extends H{};$(K,"ArrayType",G);var m=class extends H{};$(m,"ArrayType",Array);var pe=class extends m{value(e){return null}},P=class extends K{value(e){return F(this.values[e])}},Ue=class extends K{value(e){let t=this.values[e],n=(t&31744)>>10,s=(t&1023)/1024,o=(-1)**((t&32768)>>15);switch(n){case 31:return o*(s?Number.NaN:1/0);case 0:return o*(s?6103515625e-14*s:0)}return o*2**(n-15)*(1+s)}},ve=class extends m{value(e){return Ut(this.values,e)}},Be=class extends K{constructor(e){super(e);let{scale:t}=this.type;this.scale=10**t}value(e){return this.values[e]/this.scale}},Me=class extends H{constructor(e){super(e);let{bitWidth:t,scale:n}=this.type;this.decimal=t===64?_r:t===128?gr:Rr,this.scale=10n**BigInt(n)}},ue=class extends Me{value(e){return Pe(this.decimal(this.values,e),this.scale)}};$(ue,"ArrayType",G);var le=class extends Me{value(e){return this.decimal(this.values,e)}};$(le,"ArrayType",Array);var fe=class extends m{constructor(e){super(e),this.source=e}value(e){return new Date(this.source.value(e))}},We=class extends K{value(e){return 864e5*this.values[e]}},kr=P,Ge=class extends P{value(e){return super.value(e)*1e3}},Or=P,Ve=class extends P{value(e){return Pe(this.values[e],1000n)}},je=class extends P{value(e){return Pe(this.values[e],1000000n)}},He=class extends m{value(e){return this.values.subarray(e<<1,e+1<<1)}},Ye=class extends m{value(e){let t=this.values,n=e<<4;return Float64Array.of(f(t,n),f(t,n+4),I(t,n+8))}},Ar=({values:r,offsets:e},t)=>r.subarray(e[t],e[t+1]),Dr=({values:r,offsets:e},t)=>r.subarray(F(e[t]),F(e[t+1])),Qe=class extends m{value(e){return Ar(this,e)}},Ke=class extends m{value(e){return Dr(this,e)}},qe=class extends m{value(e){return re(Ar(this,e))}},ze=class extends m{value(e){return re(Dr(this,e))}},$e=class extends m{value(e){let t=this.offsets;return this.children[0].slice(t[e],t[e+1])}},Je=class extends m{value(e){let t=this.offsets;return this.children[0].slice(F(t[e]),F(t[e+1]))}},Xe=class extends m{value(e){let t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(t,n)}},Ze=class extends m{value(e){let t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(F(t),F(n))}},et=class extends m{constructor(e){super(e),this.stride=this.type.stride}},tt=class extends et{value(e){let{stride:t,values:n}=this;return n.subarray(e*t,(e+1)*t)}},rt=class extends et{value(e){let{children:t,stride:n}=this;return t[0].slice(e*n,(e+1)*n)}};function Nr({children:r,offsets:e},t){let[n,s]=r[0].children,o=e[t],i=e[t+1],c=[];for(let d=o;d<i;++d)c.push([n.at(d),s.at(d)]);return c}var nt=class extends m{value(e){return Nr(this,e)}},st=class extends m{value(e){return new Map(Nr(this,e))}},me=class extends m{constructor({typeIds:e,...t}){super(t),this.typeIds=e,this.typeMap=this.type.typeMap}value(e,t=e){let{typeIds:n,children:s,typeMap:o}=this;return s[o[n[e]]].at(t)}},ot=class extends me{value(e){return super.value(e,this.offsets[e])}},he=class extends m{constructor(e,t=Ce){super(e),this.names=this.type.children.map(n=>n.name),this.factory=t(this.names,this.children)}value(e){return this.factory(e)}},it=class extends he{constructor(e){super(e,de)}},at=class extends m{value(e){let[{values:t},n]=this.children;return n.at(Z(t,e))}},ct=class extends m{setDictionary(e){return this.dictionary=e,this.cache=e.cache(),this}value(e){return this.cache[this.key(e)]}key(e){return this.values[e]}},dt=class extends m{constructor({data:e,...t}){super(t),this.data=e}view(e){let{values:t,data:n}=this,s=e<<4,o=s+4,i=t,c=f(i,s);return c>12&&(o=f(i,s+12),i=n[f(i,s+8)]),i.subarray(o,o+c)}},ut=class extends dt{value(e){return this.view(e)}},lt=class extends dt{value(e){return re(this.view(e))}};function vt(r){let e=[];return{add(t){return e.push(t),this},clear:()=>e=[],done:()=>new q(e,r)}}var q=class{constructor(e,t=(n=>(n=e[0])==null?void 0:n.type)()){this.type=t,this.length=e.reduce((i,c)=>i+c.length,0),this.nullCount=e.reduce((i,c)=>i+c.nullCount,0),this.data=e;let s=e.length,o=new Int32Array(s+1);if(s===1){let[i]=e;o[1]=i.length,this.at=c=>i.at(c)}else for(let i=0,c=0;i<s;++i)o[i+1]=c+=e[i].length;this.offsets=o}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){let e=this.data;return e.length===1?e[0][Symbol.iterator]():Rn(e)}at(e){var o;let{data:t,offsets:n}=this,s=Z(n,e)-1;return(o=t[s])==null?void 0:o.at(e-n[s])}get(e){return this.at(e)}toArray(){var d;let{length:e,nullCount:t,data:n}=this,s=!t&&Sr(n[0]),o=n.length;if(s&&o===1)return n[0].values;let i=!o||t>0?Array:(d=n[0].constructor.ArrayType)!=null?d:n[0].values.constructor,c=new i(e);return s?Tn(c,n):bn(c,n)}cache(){var e;return(e=this._cache)!=null?e:this._cache=this.toArray()}};function*Rn(r){for(let e=0;e<r.length;++e){let t=r[e][Symbol.iterator]();for(let n=t.next();!n.done;n=t.next())yield n.value}}function Tn(r,e){for(let t=0,n=0;t<e.length;++t){let{values:s}=e[t];r.set(s,n),n+=s.length}return r}function bn(r,e){let t=-1;for(let n=0;n<e.length;++n){let s=e[n];for(let o=0;o<s.length;++o)r[++t]=s.at(o)}return r}var ne=class r{constructor(e,t,n=!1){let s=e.fields.map(i=>i.name);this.schema=e,this.names=s,this.children=t,this.factory=n?de:Ce;let o=[];this.getFactory=i=>{var c;return(c=o[i])!=null?c:o[i]=this.factory(s,t.map(d=>d.data[i]))}}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e,t;return(t=(e=this.children[0])==null?void 0:e.length)!=null?t:0}getChildAt(e){return this.children[e]}getChild(e){let t=this.names.findIndex(n=>n===e);return t>-1?this.children[t]:void 0}selectAt(e,t=[]){let{children:n,factory:s,schema:o}=this,{fields:i}=o;return new r({...o,fields:e.map((c,d)=>Sn(i[c],t[d]))},e.map(c=>n[c]),s===de)}select(e,t){let n=this.names,s=e.map(o=>n.indexOf(o));return this.selectAt(s,t)}toColumns(){let{children:e,names:t}=this,n={};return t.forEach((s,o)=>{var i,c;return n[s]=(c=(i=e[o])==null?void 0:i.toArray())!=null?c:[]}),n}toArray(){var i,c;let{children:e,getFactory:t,numRows:n}=this,s=(c=(i=e[0])==null?void 0:i.data)!=null?c:[],o=Array(n);for(let d=0,p=-1;d<s.length;++d){let T=t(d);for(let g=0;g<s[d].length;++g)o[++p]=T(g)}return o}*[Symbol.iterator](){var s,o;let{children:e,getFactory:t}=this,n=(o=(s=e[0])==null?void 0:s.data)!=null?o:[];for(let i=0;i<n.length;++i){let c=t(i);for(let d=0;d<n[i].length;++d)yield c(d)}}at(e){let{children:t,getFactory:n,numRows:s}=this;if(e<0||e>=s)return null;let[{offsets:o}]=t,i=Z(o,e)-1;return n(i)(e-o[i])}get(e){return this.at(e)}};function Sn(r,e){return e!=null&&e!==r.name?{...r,name:e}:r}function Ee(r,e={}){let{typeId:t,bitWidth:n,mode:s,precision:o,unit:i}=r,{useBigInt:c,useDate:d,useDecimalInt:p,useMap:T,useProxy:g}=e;switch(t){case a.Null:return pe;case a.Bool:return ve;case a.Int:case a.Time:case a.Duration:return c||n<64?v:P;case a.Float:return o?v:Ue;case a.Date:return Lr(i===x.DAY?We:kr,d&&fe);case a.Timestamp:return Lr(i===E.SECOND?Ge:i===E.MILLISECOND?Or:i===E.MICROSECOND?Ve:je,d&&fe);case a.Decimal:return n===32?p?v:Be:p?le:ue;case a.Interval:return i===L.DAY_TIME?He:i===L.YEAR_MONTH?v:Ye;case a.FixedSizeBinary:return tt;case a.Utf8:return qe;case a.LargeUtf8:return ze;case a.Binary:return Qe;case a.LargeBinary:return Ke;case a.BinaryView:return ut;case a.Utf8View:return lt;case a.List:return $e;case a.LargeList:return Je;case a.Map:return T?st:nt;case a.ListView:return Xe;case a.LargeListView:return Ze;case a.FixedSizeList:return rt;case a.Struct:return g?it:he;case a.RunEndEncoded:return at;case a.Dictionary:return ct;case a.Union:return s?ot:me}throw new Error(U(t))}function Lr(r,e){return e?class extends e{constructor(n){super(new r(n))}}:r}function kn(r,e){return{offset:I(r,e),metadataLength:f(r,e+8),bodyLength:I(r,e+16)}}function Bt(r,e){return D(r,e,24,kn)}function pt(r,e,t){let n=R(r,e);if(n(10,w,0))throw new Error("Record batch compression not implemented");let s=t<N.V4?8:0;return{length:n(4,I,0),nodes:D(r,n(6,w),16,(o,i)=>({length:I(o,i),nullCount:I(o,i+8)})),regions:D(r,n(8,w),16+s,(o,i)=>({offset:I(o,i+s),length:I(o,i+s+8)})),variadic:D(r,n(12,w),8,I)}}function wr(r,e,t){let n=R(r,e);return{id:n(4,I,0),data:n(6,(s,o)=>pt(s,o,t)),isDelta:n(8,j,!1)}}function Mt(r,e,t,n){A(t,a,U);let s=R(r,e);switch(t){case a.Binary:return Tt();case a.Utf8:return Ae();case a.LargeBinary:return Lt();case a.LargeUtf8:return wt();case a.List:return Ne(n[0]);case a.ListView:return xt(n[0]);case a.LargeList:return Ft(n[0]);case a.LargeListView:return Ct(n[0]);case a.Struct:return Le(n);case a.RunEndEncoded:return Pt(n[0],n[1]);case a.Int:return Oe(s(4,f,0),s(6,j,!1));case a.Float:return Rt(s(4,_,J.HALF));case a.Decimal:return bt(s(4,f,0),s(6,f,0),s(8,f,128));case a.Date:return St(s(4,_,x.MILLISECOND));case a.Time:return kt(s(4,_,E.MILLISECOND));case a.Timestamp:return De(s(4,_,E.SECOND),s(6,Q));case a.Interval:return Ot(s(4,_,L.YEAR_MONTH));case a.Duration:return Nt(s(4,_,E.MILLISECOND));case a.FixedSizeBinary:return Dt(s(4,f,0));case a.FixedSizeList:return we(n[0],s(4,f,0));case a.Map:return yr(s(4,j,!1),n[0]);case a.Union:return At(s(4,_,C.Sparse),n,D(r,s(6,w),4,f))}return{typeId:t}}function ye(r,e){let t=D(r,e,4,(n,s)=>{let o=R(n,s);return[o(4,Q),o(6,Q)]});return t.length?new Map(t):null}function ft(r,e,t){let n=R(r,e);return{version:t,endianness:n(4,_,0),fields:n(6,On,[]),metadata:n(8,ye)}}function On(r,e){return D(r,e,4,Fr)}function Fr(r,e){let t=R(r,e),n=t(8,ce,a.NONE),s=t(10,w,0),o=t(12,Dn),i=t(14,(d,p)=>An(d,p)),c=Mt(r,s,n,i);return o&&(o.dictionary=c,c=o),{name:t(4,Q),type:c,nullable:t(6,j,!1),metadata:t(16,ye)}}function An(r,e){let t=D(r,e,4,Fr);return t.length?t:null}function Dn(r,e){if(!e)return null;let t=R(r,e);return ke(null,t(6,Nn,ee()),t(8,j,!1),t(4,I,0))}function Nn(r,e){return Mt(r,e,a.Int)}var Ln=(r,e)=>`Expected to read ${r} metadata bytes, but only read ${e}.`,wn=(r,e)=>`Expected to read ${r} bytes for message body, but only read ${e}.`,Fn=r=>`Unsupported message type: ${r} (${Se(k,r)})`;function mt(r,e){let t=f(r,e)||0;if(e+=Y,t===-1&&(t=f(r,e)||0,e+=Y),t===0)return null;let n=r.subarray(e,e+=t);if(n.byteLength<t)throw new Error(Ln(t,n.byteLength));let s=R(n,0),o=s(4,_,N.V1),i=s(6,ce,k.NONE),c=s(8,w,0),d=s(10,I,0),p;if(c){let T=i===k.Schema?ft:i===k.DictionaryBatch?wr:i===k.RecordBatch?pt:null;if(!T)throw new Error(Fn(i));if(p=T(n,c,o),d>0){let g=r.subarray(e,e+=d);if(g.byteLength<d)throw new Error(wn(d,g.byteLength));p.body=g}else i!==k.Schema&&(p.body=new Uint8Array(0))}return{version:o,type:i,index:e,content:p}}function Pr(r){let e=fr(r)?new Uint8Array(r):r;return e instanceof Uint8Array&&Pn(e)?Cn(e):xn(e)}function Pn(r){if(!r||r.length<4)return!1;for(let e=0;e<6;++e)if(oe[e]!==r[e])return!1;return!0}function xn(r){let e=[r].flat(),t,n=[],s=[];for(let o of e){if(!(o instanceof Uint8Array))throw new Error("IPC data batch was not a Uint8Array.");let i=0;for(;;){let c=mt(o,i);if(c===null)break;if(i=c.index,!!c.content)switch(c.type){case k.Schema:t||(t=c.content);break;case k.RecordBatch:n.push(c.content);break;case k.DictionaryBatch:s.push(c.content);break}}}return{schema:t,dictionaries:s,records:n,metadata:null}}function Cn(r){let e=r.byteLength-(oe.length+4),t=f(r,e),n=R(r,e-t),s=n(4,_,N.V1),o=n(8,Bt,[]),i=n(10,Bt,[]);return{schema:n(6,(c,d)=>ft(c,d,s)),dictionaries:o.map(({offset:c})=>mt(r,c).content),records:i.map(({offset:c})=>mt(r,c).content),metadata:n(12,ye)}}function ht(r,e){return Un(Pr(r),e)}function Un(r,e={}){let{schema:t={fields:[]},dictionaries:n,records:s}=r,{version:o,fields:i}=t,c=new Map,d=Bn(e,o,c),p=new Map;vn(t,S=>{let y=S.type;y.typeId===a.Dictionary&&p.set(y.id,y.dictionary)});let T=new Map;for(let S of n){let{id:y,data:M,isDelta:W,body:Jr}=S,tr=p.get(y),rr=Wt(tr,d({...M,body:Jr}));if(T.has(y)){let nr=T.get(y);W||nr.clear(),nr.add(rr)}else{if(W)throw new Error("Delta update can not be first dictionary batch.");T.set(y,vt(tr).add(rr))}}T.forEach((S,y)=>c.set(y,S.done()));let g=i.map(S=>vt(S.type));for(let S of s){let y=d(S);i.forEach((M,W)=>g[W].add(Wt(M.type,y)))}return new ne(t,g.map(S=>S.done()),e.useProxy)}function vn(r,e){r.fields.forEach(function t(n){var s,o,i;e(n),(o=(s=n.type.dictionary)==null?void 0:s.children)==null||o.forEach(t),(i=n.type.children)==null||i.forEach(t)})}function Bn(r,e,t){let n={version:e,options:r,dictionary:s=>t.get(s)};return s=>{let{length:o,nodes:i,regions:c,variadic:d,body:p}=s,T=-1,g=-1,S=-1;return{...n,length:o,node:()=>i[++T],buffer:y=>{let{length:M,offset:W}=c[++g];return y?new y(p.buffer,p.byteOffset+W,M/y.BYTES_PER_ELEMENT):p.subarray(W,W+M)},variadic:()=>d[++S],visit(y){return y.map(M=>Wt(M.type,this))}}}}function Wt(r,e){let{typeId:t}=r,{options:n,node:s,buffer:o,variadic:i,version:c}=e,d=Ee(r,n),p={...s(),type:r};if(t===a.Null)return new d({...p,nullCount:p.length});switch(t){case a.Bool:case a.Int:case a.Time:case a.Duration:case a.Float:case a.Decimal:case a.Date:case a.Timestamp:case a.Interval:case a.FixedSizeBinary:return new d({...p,validity:o(),values:o(r.values)});case a.Utf8:case a.LargeUtf8:case a.Binary:case a.LargeBinary:return new d({...p,validity:o(),offsets:o(r.offsets),values:o()});case a.BinaryView:case a.Utf8View:return new d({...p,validity:o(),values:o(),data:Array.from({length:i()},()=>o())});case a.List:case a.LargeList:case a.Map:return new d({...p,validity:o(),offsets:o(r.offsets),children:e.visit(r.children)});case a.ListView:case a.LargeListView:return new d({...p,validity:o(),offsets:o(r.offsets),sizes:o(r.offsets),children:e.visit(r.children)});case a.FixedSizeList:case a.Struct:return new d({...p,validity:o(),children:e.visit(r.children)});case a.RunEndEncoded:return new d({...p,children:e.visit(r.children)});case a.Dictionary:{let{id:T,indices:g}=r;return new d({...p,validity:o(),values:o(g.values)}).setDictionary(e.dictionary(T))}case a.Union:return c<N.V5&&o(),new d({...p,typeIds:o(ie),offsets:r.mode===C.Sparse?null:o(r.offsets),children:e.visit(r.children)});default:throw new Error(U(t))}}var bi=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Ie=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e);return ht(t)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e,t);for(;n==null;){if(this._bindings.isDetached()){console.error("cannot send a message since the worker is not set!");return}n=await this._bindings.pollPendingQuery(this._conn)}return new _e(this._bindings,this._conn,n)}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new Et(this._bindings,this._conn,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},_e=class{constructor(e,t,n){this.db=e;this.conn=t;this.header=n;this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(this._inFlight!=null&&(e=await this._inFlight,this._inFlight=null);e==null;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=e.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},Et=class{constructor(e,t,n){this.bindings=e,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e);return ht(t)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e);return new _e(this.bindings,this.connectionId,t)}};var Gt=(l=>(l.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",l.CLOSE_PREPARED="CLOSE_PREPARED",l.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",l.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",l.CONNECT="CONNECT",l.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",l.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",l.CREATE_PREPARED="CREATE_PREPARED",l.DISCONNECT="DISCONNECT",l.DROP_FILE="DROP_FILE",l.DROP_FILES="DROP_FILES",l.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",l.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",l.FLUSH_FILES="FLUSH_FILES",l.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",l.GET_TABLE_NAMES="GET_TABLE_NAMES",l.GET_VERSION="GET_VERSION",l.GLOB_FILE_INFOS="GLOB_FILE_INFOS",l.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",l.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",l.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",l.INSTANTIATE="INSTANTIATE",l.OPEN="OPEN",l.PING="PING",l.POLL_PENDING_QUERY="POLL_PENDING_QUERY",l.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",l.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",l.REGISTER_FILE_URL="REGISTER_FILE_URL",l.RESET="RESET",l.RUN_PREPARED="RUN_PREPARED",l.RUN_QUERY="RUN_QUERY",l.SEND_PREPARED="SEND_PREPARED",l.START_PENDING_QUERY="START_PENDING_QUERY",l.TOKENIZE="TOKENIZE",l))(Gt||{}),Vt=(h=>(h.CONNECTION_INFO="CONNECTION_INFO",h.ERROR="ERROR",h.FEATURE_FLAGS="FEATURE_FLAGS",h.FILE_BUFFER="FILE_BUFFER",h.FILE_INFOS="FILE_INFOS",h.FILE_SIZE="FILE_SIZE",h.FILE_STATISTICS="FILE_STATISTICS",h.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",h.LOG="LOG",h.PROGRESS_UPDATE="PROGRESS_UPDATE",h.OK="OK",h.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",h.QUERY_PLAN="QUERY_PLAN",h.QUERY_RESULT="QUERY_RESULT",h.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",h.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",h.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",h.REGISTERED_FILE="REGISTERED_FILE",h.SCRIPT_TOKENS="SCRIPT_TOKENS",h.SUCCESS="SUCCESS",h.TABLE_NAMES="TABLE_NAMES",h.VERSION_STRING="VERSION_STRING",h))(Vt||{}),u=class{constructor(e,t){this.promiseResolver=()=>{};this.promiseRejecter=()=>{};this.type=e,this.data=t,this.promise=new Promise((n,s)=>{this.promiseResolver=n,this.promiseRejecter=s})}};var as=/'(opfs:\/\/\S*?)'/g,cs=/(opfs:\/\/\S*?)/g;function Wr(r){return r.search(cs)>-1}function Gr(r){return[...r.matchAll(as)].map(e=>e[1])}var ds=new TextEncoder,jt=class{constructor(e,t=null){this._onInstantiationProgress=[];this._onExecutionProgress=[];this._worker=null;this._workerShutdownPromise=null;this._workerShutdownResolver=()=>{};this._nextMessageId=0;this._pendingRequests=new Map;this._config={};this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}get config(){return this._config}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,n)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!:"+e.type+","+e.data);return}let n=this._nextMessageId++;return this._pendingRequests.set(n,e),this._worker.postMessage({messageId:n,type:e.type,data:e.data},t),await e.promise}onMessage(e){var s;let t=e.data;switch(t.type){case"PROGRESS_UPDATE":{for(let o of this._onExecutionProgress)o(t.data);return}case"LOG":{this._logger.log(t.data);return}case"INSTANTIATE_PROGRESS":{for(let o of this._onInstantiationProgress)o(t.data);return}}let n=this._pendingRequests.get(t.requestId);if(!n){console.warn(`unassociated response: [${t.requestId}, ${t.type.toString()}]`);return}if(this._pendingRequests.delete(t.requestId),t.type=="ERROR"){let o=new Error(t.data.message);o.name=t.data.name,(s=Object.getOwnPropertyDescriptor(o,"stack"))!=null&&s.writable&&(o.stack=t.data.stack),n.promiseRejecter(o);return}switch(n.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(t.type=="OK"){n.promiseResolver(t.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],t.type=="OK"){n.promiseResolver(t.data);return}break;case"GLOB_FILE_INFOS":if(t.type=="FILE_INFOS"){n.promiseResolver(t.data);return}break;case"GET_VERSION":if(t.type=="VERSION_STRING"){n.promiseResolver(t.data);return}break;case"GET_FEATURE_FLAGS":if(t.type=="FEATURE_FLAGS"){n.promiseResolver(t.data);return}break;case"GET_TABLE_NAMES":if(t.type=="TABLE_NAMES"){n.promiseResolver(t.data);return}break;case"TOKENIZE":if(t.type=="SCRIPT_TOKENS"){n.promiseResolver(t.data);return}break;case"COPY_FILE_TO_BUFFER":if(t.type=="FILE_BUFFER"){n.promiseResolver(t.data);return}break;case"EXPORT_FILE_STATISTICS":if(t.type=="FILE_STATISTICS"){n.promiseResolver(t.data);return}break;case"CONNECT":if(t.type=="CONNECTION_INFO"){n.promiseResolver(t.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(t.type=="QUERY_RESULT"){n.promiseResolver(t.data);return}break;case"SEND_PREPARED":if(t.type=="QUERY_RESULT_HEADER"){n.promiseResolver(t.data);return}break;case"START_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){n.promiseResolver(t.data);return}break;case"POLL_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){n.promiseResolver(t.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],t.type=="SUCCESS"){n.promiseResolver(t.data);return}break;case"FETCH_QUERY_RESULTS":if(t.type=="QUERY_RESULT_CHUNK"){n.promiseResolver(t.data);return}break;case"CREATE_PREPARED":if(t.type=="PREPARED_STATEMENT_ID"){n.promiseResolver(t.data);return}break}n.promiseRejecter(new Error(`unexpected response type: ${t.type.toString()}`))}onError(e){console.error(e),console.error(`error in duckdb worker: ${e.message}`),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn(`worker terminated with ${this._pendingRequests.size} pending requests`);return}this._pendingRequests.clear()}isDetached(){return!this._worker}async reset(){let e=new u("RESET",null);return await this.postTask(e)}async ping(){let e=new u("PING",null);await this.postTask(e)}async dropFile(e){let t=new u("DROP_FILE",e);return await this.postTask(t)}async dropFiles(e){let t=new u("DROP_FILES",e);return await this.postTask(t)}async flushFiles(){let e=new u("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,n=s=>{}){this._onInstantiationProgress.push(n);let s=new u("INSTANTIATE",[e,t]);return await this.postTask(s)}async getVersion(){let e=new u("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new u("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){this._config=e;let t=new u("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new u("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new u("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new Ie(this,e)}async disconnect(e){let t=new u("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){if(this.shouldOPFSFileHandling()){let n=await this.registerOPFSFileFromSQL(t);try{return await this._runQueryAsync(e,t)}finally{n.length>0&&await this.dropFiles(n)}}else return await this._runQueryAsync(e,t)}async _runQueryAsync(e,t){let n=new u("RUN_QUERY",[e,t]);return await this.postTask(n)}async startPendingQuery(e,t,n=!1){if(this.shouldOPFSFileHandling()){let s=await this.registerOPFSFileFromSQL(t);try{return await this._startPendingQueryAsync(e,t,n)}finally{s.length>0&&await this.dropFiles(s)}}else return await this._startPendingQueryAsync(e,t,n)}async _startPendingQueryAsync(e,t,n=!1){let s=new u("START_PENDING_QUERY",[e,t,n]);return await this.postTask(s)}async pollPendingQuery(e){let t=new u("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new u("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new u("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let n=new u("GET_TABLE_NAMES",[e,t]);return await this.postTask(n)}async createPrepared(e,t){let n=new u("CREATE_PREPARED",[e,t]);return await this.postTask(n)}async closePrepared(e,t){let n=new u("CLOSE_PREPARED",[e,t]);await this.postTask(n)}async runPrepared(e,t,n){let s=new u("RUN_PREPARED",[e,t,n]);return await this.postTask(s)}async sendPrepared(e,t,n){let s=new u("SEND_PREPARED",[e,t,n]);return await this.postTask(s)}async globFiles(e){let t=new u("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let n=ds.encode(t);await this.registerFileBuffer(e,n)}async registerFileURL(e,t,n,s){t===void 0&&(t=e);let o=new u("REGISTER_FILE_URL",[e,t,n,s]);await this.postTask(o)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let n=new u("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(e,t,n,s){let o=new u("REGISTER_FILE_HANDLE",[e,t,n,s]);await this.postTask(o,[])}async registerOPFSFileName(e){let t=new u("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let n=new u("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(n,[])}async exportFileStatistics(e){let t=new u("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new u("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let n=new u("COPY_FILE_TO_PATH",[e,t]);await this.postTask(n)}async insertArrowFromIPCStream(e,t,n){if(t.length==0)return;let s=new u("INSERT_ARROW_FROM_IPC_STREAM",[e,t,n]);await this.postTask(s,[t.buffer])}async insertCSVFromPath(e,t,n){let s=new u("IMPORT_CSV_FROM_PATH",[e,t,n]);await this.postTask(s)}async insertJSONFromPath(e,t,n){let s=new u("IMPORT_JSON_FROM_PATH",[e,t,n]);await this.postTask(s)}shouldOPFSFileHandling(){var e,t;return Wr((e=this.config.path)!=null?e:"")?((t=this.config.opfs)==null?void 0:t.fileHandling)=="auto":!1}async registerOPFSFileFromSQL(e){let t=Gr(e),n=[];for(let s of t)try{await this.registerOPFSFileName(s),n.push(s)}catch(o){throw console.error(o),new Error("File Not found:"+s)}return n}};function us(){let r=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),r.decode(e))}var du=us();var Ht=(i=>(i[i.BUFFER=0]="BUFFER",i[i.NODE_FS=1]="NODE_FS",i[i.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",i[i.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",i[i.HTTP=4]="HTTP",i[i.S3=5]="S3",i))(Ht||{});var Yt=class{constructor(){this._bindings=null;this._nextMessageId=0}log(e){this.postMessage({messageId:this._nextMessageId++,requestId:0,type:"LOG",data:e},[])}sendOK(e){this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"OK",data:null},[])}failWith(e,t){let n={name:t.name,message:t.message,stack:t.stack||void 0};this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"ERROR",data:n},[])}async onMessage(e){switch(e.type){case"PING":this.sendOK(e);return;case"INSTANTIATE":this._bindings!=null&&this.failWith(e,new Error("duckdb already initialized"));try{this._bindings=await this.instantiate(e.data[0],e.data[1],t=>{this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"INSTANTIATE_PROGRESS",data:t},[])}),this.sendOK(e)}catch(t){console.log(t),this._bindings=null,this.failWith(e,t)}return;default:break}if(!this._bindings)return this.failWith(e,new Error("duckdb is not initialized"));try{switch(e.type){case"GET_VERSION":this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"VERSION_STRING",data:this._bindings.getVersion()},[]);break;case"GET_FEATURE_FLAGS":this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FEATURE_FLAGS",data:this._bindings.getFeatureFlags()},[]);break;case"RESET":this._bindings.reset(),this.sendOK(e);break;case"OPEN":{let t=e.data.path;t!=null&&t.startsWith("opfs://")&&(await this._bindings.prepareDBFileHandle(t,3),e.data.useDirectIO=!0),this._bindings.open(e.data),this.sendOK(e);break}case"DROP_FILE":this._bindings.dropFile(e.data),this.sendOK(e);break;case"DROP_FILES":this._bindings.dropFiles(e.data),this.sendOK(e);break;case"FLUSH_FILES":this._bindings.flushFiles(),this.sendOK(e);break;case"CONNECT":{let t=this._bindings.connect();this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"CONNECTION_INFO",data:t.useUnsafe((n,s)=>s)},[]);break}case"DISCONNECT":this._bindings.disconnect(e.data),this.sendOK(e);break;case"CREATE_PREPARED":{let t=this._bindings.createPrepared(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"PREPARED_STATEMENT_ID",data:t},[]);break}case"CLOSE_PREPARED":{this._bindings.closePrepared(e.data[0],e.data[1]),this.sendOK(e);break}case"RUN_PREPARED":{let t=this._bindings.runPrepared(e.data[0],e.data[1],e.data[2]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT",data:t},[t.buffer]);break}case"RUN_QUERY":{let t=this._bindings.runQuery(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT",data:t},[t.buffer]);break}case"SEND_PREPARED":{let t=this._bindings.sendPrepared(e.data[0],e.data[1],e.data[2]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER",data:t},[t.buffer]);break}case"START_PENDING_QUERY":{let t=this._bindings.startPendingQuery(e.data[0],e.data[1],e.data[2]),n=[];t&&n.push(t.buffer),this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER_OR_NULL",data:t},n);break}case"POLL_PENDING_QUERY":{let t=this._bindings.pollPendingQuery(e.data),n=[];t&&n.push(t.buffer),this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_HEADER_OR_NULL",data:t},n);break}case"CANCEL_PENDING_QUERY":{let t=this._bindings.cancelPendingQuery(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"SUCCESS",data:t},[]);break}case"FETCH_QUERY_RESULTS":{let t=this._bindings.fetchQueryResults(e.data),n=t?[t.buffer]:[];this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"QUERY_RESULT_CHUNK",data:t},n);break}case"GET_TABLE_NAMES":{let t=this._bindings.getTableNames(e.data[0],e.data[1]);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"TABLE_NAMES",data:t},[]);break}case"GLOB_FILE_INFOS":{let t=this._bindings.globFiles(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_INFOS",data:t},[]);break}case"REGISTER_FILE_URL":this._bindings.registerFileURL(e.data[0],e.data[1],e.data[2],e.data[3]),this.sendOK(e);break;case"REGISTER_FILE_BUFFER":this._bindings.registerFileBuffer(e.data[0],e.data[1]),this.sendOK(e);break;case"REGISTER_FILE_HANDLE":await this._bindings.registerFileHandleAsync(e.data[0],e.data[1],e.data[2],e.data[3]),this.sendOK(e);break;case"COPY_FILE_TO_PATH":this._bindings.copyFileToPath(e.data[0],e.data[1]),this.sendOK(e);break;case"COPY_FILE_TO_BUFFER":{let t=this._bindings.copyFileToBuffer(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_BUFFER",data:t},[]);break}case"COLLECT_FILE_STATISTICS":this._bindings.collectFileStatistics(e.data[0],e.data[1]),this.sendOK(e);break;case"REGISTER_OPFS_FILE_NAME":await this._bindings.registerOPFSFileName(e.data[0]),this.sendOK(e);break;case"EXPORT_FILE_STATISTICS":{this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"FILE_STATISTICS",data:this._bindings.exportFileStatistics(e.data)},[]);break}case"INSERT_ARROW_FROM_IPC_STREAM":{this._bindings.insertArrowFromIPCStream(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"IMPORT_CSV_FROM_PATH":{this._bindings.insertCSVFromPath(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"IMPORT_JSON_FROM_PATH":{this._bindings.insertJSONFromPath(e.data[0],e.data[1],e.data[2]),this.sendOK(e);break}case"TOKENIZE":{let t=this._bindings.tokenize(e.data);this.postMessage({messageId:this._nextMessageId++,requestId:e.messageId,type:"SCRIPT_TOKENS",data:t},[]);break}}}catch(t){return console.log(t),this.failWith(e,t)}}};var Vr=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),jr=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11]));var Hr=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));var Yr=()=>(async r=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(r)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));var yt={name:"@duckdb/duckdb-wasm",version:"1.11.0",description:"DuckDB powered by WebAssembly",license:"MIT",repository:{type:"git",url:"https://github.com/duckdb/duckdb-wasm.git"},keywords:["sql","duckdb","relational","database","data","query","wasm","analytics","olap","arrow","parquet","json","csv"],dependencies:{"@nodelib/fs.stat":"^4.0.0","@nodelib/fs.walk":"^3.0.1","@uwdata/flechette":"latest","fast-glob":"^3.3.3","glob-parent":"^6.0.2",merge2:"^1.4.1",micromatch:"^4.0.8"},devDependencies:{"@nodelib/fs.stat":"^4.0.0","@nodelib/fs.walk":"^3.0.1","@types/emscripten":"^1.39.10","@types/jasmine":"^5.1.4","@types/merge2":"^1","@types/micromatch":"^4","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0",esbuild:"^0.20.2",eslint:"^8.57.0","eslint-plugin-jasmine":"^4.1.3","eslint-plugin-react":"^7.34.0",glob:"^13.0.0",jasmine:"^5.1.0","jasmine-core":"^5.1.2","jasmine-spec-reporter":"^7.0.0","js-sha256":"^0.11.1",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-coverage":"^2.2.1","karma-firefox-launcher":"^2.1.3","karma-jasmine":"^5.1.0","karma-jasmine-html-reporter":"^2.1.0","karma-sourcemap-loader":"^0.4.0","karma-spec-reporter":"^0.0.36","make-dir":"^4.0.0",nyc:"^15.1.0",prettier:"^3.2.5",puppeteer:"^22.8.0",rimraf:"^3.0.2",s3rver:"^3.7.1",semver:"^7.6.0",typedoc:"^0.25.13",typescript:"^5.3.3","wasm-feature-detect":"^1.6.1","web-worker":"^1.2.0"},scripts:{"build:debug":"node bundle.mjs debug && tsc --emitDeclarationOnly","build:release":"node bundle.mjs release && tsc --emitDeclarationOnly",docs:"typedoc",format:'prettier --write "**/*.+(js|ts)"',report:"node ./coverage.mjs","test:node":"node --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:debug":"node --inspect-brk --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:coverage":"nyc -r json --report-dir ./coverage/node node ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:firefox":"karma start ./karma/tests-firefox.cjs","test:chrome":"karma start ./karma/tests-chrome.cjs","test:chrome:eh":"karma start ./karma/tests-chrome-eh.cjs","test:chrome:coverage":"karma start ./karma/tests-chrome-coverage.cjs","test:browser":"karma start ./karma/tests-all.cjs","test:browser:debug":"karma start ./karma/tests-debug.cjs",test:"npm run test:chrome && npm run test:node","test:coverage":"npm run test:chrome:coverage && npm run test:node:coverage && npm run report",lint:"eslint src test"},files:["dist","!dist/tests-*","!dist/duckdb-browser-mvp.worker.js.map","!dist/types/test"],main:"dist/duckdb-browser.cjs",module:"dist/duckdb-browser.mjs",types:"dist/duckdb-browser.d.ts",jsdelivr:"dist/duckdb-browser.cjs",unpkg:"dist/duckdb-browser.mjs",sideEffects:!1,browser:{fs:!1,os:!1,path:!1,perf_hooks:!1,worker_threads:!1},exports:{"./dist/duckdb-mvp.wasm":"./dist/duckdb-mvp.wasm","./dist/duckdb-eh.wasm":"./dist/duckdb-eh.wasm","./dist/duckdb-coi.wasm":"./dist/duckdb-coi.wasm","./dist/duckdb-browser":"./dist/duckdb-browser.mjs","./dist/duckdb-browser.cjs":"./dist/duckdb-browser.cjs","./dist/duckdb-browser.mjs":"./dist/duckdb-browser.mjs","./dist/duckdb-browser-coi.pthread.worker.js":"./dist/duckdb-browser-coi.pthread.worker.js","./dist/duckdb-browser-coi.worker.js":"./dist/duckdb-browser-coi.worker.js","./dist/duckdb-browser-eh.worker.js":"./dist/duckdb-browser-eh.worker.js","./dist/duckdb-browser-mvp.worker.js":"./dist/duckdb-browser-mvp.worker.js","./dist/duckdb-node":"./dist/duckdb-node.cjs","./dist/duckdb-node.cjs":"./dist/duckdb-node.cjs","./dist/duckdb-node-blocking":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-blocking.cjs":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-eh.worker.cjs":"./dist/duckdb-node-eh.worker.cjs","./dist/duckdb-node-mvp.worker.cjs":"./dist/duckdb-node-mvp.worker.cjs","./blocking":{node:{types:"./dist/duckdb-node-blocking.d.ts",require:"./dist/duckdb-node-blocking.cjs",import:"./dist/duckdb-node-blocking.cjs"},types:"./dist/duckdb-node-blocking.d.ts",import:"./dist/duckdb-node-blocking.mjs",require:"./dist/duckdb-node-blocking.cjs"},".":{browser:{types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"},node:{types:"./dist/duckdb-node.d.ts",import:"./dist/duckdb-node.cjs",require:"./dist/duckdb-node.cjs"},types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"}}};var Qt=yt.name,Kt=yt.version,qt=yt.version.split("."),fs=qt[0],ms=qt[1],hs=qt[2];var er=()=>typeof navigator>"u",Qr=()=>er()?"node":navigator.userAgent,Es=()=>Qr().includes("Firefox"),ys=()=>/^((?!chrome|android).)*safari/i.test(Qr());function Is(){let r=`https://cdn.jsdelivr.net/npm/${Qt}@${Kt}/dist/`;return{mvp:{mainModule:`${r}duckdb-mvp.wasm`,mainWorker:`${r}duckdb-browser-mvp.worker.js`},eh:{mainModule:`${r}duckdb-eh.wasm`,mainWorker:`${r}duckdb-browser-eh.worker.js`}}}var zt=null,$t=null,Jt=null,Xt=null,Zt=null;async function Kr(){return zt==null&&(zt=typeof BigInt64Array<"u"),$t==null&&($t=await jr()),Jt==null&&(Jt=await Yr()),Xt==null&&(Xt=await Hr()),Zt==null&&(Zt=await Vr()),{bigInt64Array:zt,crossOriginIsolated:er()||globalThis.crossOriginIsolated||!1,wasmExceptions:$t,wasmSIMD:Xt,wasmThreads:Jt,wasmBulkMemory:Zt}}async function _s(r){let e=await Kr();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&r.coi)return{mainModule:r.coi.mainModule,mainWorker:r.coi.mainWorker,pthreadWorker:r.coi.pthreadWorker};if(r.eh)return{mainModule:r.eh.mainModule,mainWorker:r.eh.mainWorker,pthreadWorker:null}}return{mainModule:r.mvp.mainModule,mainWorker:r.mvp.mainWorker,pthreadWorker:null}}var $r=an(zr());async function gs(r){let e=new Request(r),t=await fetch(e),n=URL.createObjectURL(await t.blob());return new $r.default(n)}
//# sourceMappingURL=duckdb-browser.cjs.map
